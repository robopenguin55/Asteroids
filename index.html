<!DOCTYPE html>
<html>
<head>
    <title>Math</title>
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"
            integrity="sha256-2Pmvv0kuTBOenSvLm6bvfBSSHrUJ+3A7x6P5Ebd07/g="
            crossorigin="anonymous"></script>
    <script type="text/javascript" src="trig.js"></script>
    <script type="text/javascript" src="2DCoordinatePlane.js"></script>
    <style type="text/css">
        canvas{border: 1px solid black;}
    </style>
    <script type="text/javascript">

        let currentLocation = [0.0,0.0];
        let currentVelocity = [0.0,0.0]; // [x,y]
        let currentDirectionAngle = 2*Math.PI; // default facing upward (which is 2Pi in js...)

        window.addEventListener('resize', function(event) {
            const canvas = document.getElementById("content");
            const context = canvas.getContext('2d');

            canvas.setAttribute("width", window.innerWidth);
            canvas.setAttribute("height", window.innerHeight);

            
            context.fillStyle = 'black';
            context.fillRect(0,0,canvas.width, canvas.height);

            drawStars(200); // redraw the stars
        }, true);

        document.onkeydown = (e) => {
            e = e || window.event;

            const canvas = document.getElementById("content");
            const ctx = canvas.getContext("2d");
            const ship = document.getElementById("ship");

            console.log(`x:${currentLocation[0]} y: ${currentLocation[1]}`);

            if (e.keyCode === 38) { // up
                e.preventDefault();

                // go forward
                // currentLocationX += currentLocationY/(Math.sin(currentDirectionAngle));
                // currentLocationY += currentLocationY/(Math.sin(currentDirectionAngle));
                currentVelocity[1]++;
            } else if (e.keyCode === 40) { // down
                e.preventDefault();
                
                // slow down
                // currentLocationX -= currentLocationY/(Math.sin(currentDirectionAngle));
                // currentLocationY -= currentLocationY/(Math.sin(currentDirectionAngle));
                if (currentVelocity[1] > 0) {
                    currentVelocity[1]--;
                }
            } else if (e.keyCode === 37) {  // left
                e.preventDefault();

                // rotate counter-clockwise
                currentDirectionAngle -= (Math.PI/6); // 30 degrees

            } else if (e.keyCode === 39) { // right
                e.preventDefault();

                // rotate clockwise
                currentDirectionAngle += (Math.PI/6); // -30 degrees
            }
        };

        $('document').ready(function(){
            const canvas = document.getElementById("content");

            canvas.setAttribute("width", window.innerWidth);
            canvas.setAttribute("height", window.innerHeight);

            const originX = canvas.width/2;
            const originY = canvas.height/2;

            currentLocation[0] = originX;
            currentLocation[1] = originY;
        
            const getRandom = function(max) {
                return Math.floor(Math.random() * max);
            };

            const context = canvas.getContext('2d');
            context.fillStyle = 'black';
            context.fillRect(0,0,canvas.width, canvas.height);

            const drawShip = function() {
                let image = new Image();

                image.id = 'ship'
                image.src = 'spaceship-25.png';
                image.onload = function() {
                    // console.log(currentDirectionAngle);
                    // console.log(`x:${currentLocation[0]} y: ${currentLocation[1]}`);
                    drawImage(image, currentLocation[0], currentLocation[1], 1, currentDirectionAngle);
                }

                return image;
            }

            const drawCircle = function(x, y) {
                if (canvas.getContext){
                    context.beginPath();
                    context.arc(x,y,1,0,(2 * Math.PI), true);
                    context.strokeStyle = 'white';
                    context.fillStyle = 'white';
                    context.stroke();
                }
            }

            const drawStars = function(count) {
                for (let i = 0; i < count; i++){
                    const randomX = getRandom(canvas.width);
                    const randomY = getRandom(canvas.height);

                    drawCircle(randomX, randomY);
                }
            }

            function drawImage(image, x, y, scale, rotation){
                context.setTransform(scale, 0, 0, scale, x, y); // sets scale and origin
                context.rotate(rotation);
                context.drawImage(image, -image.width / 2, -image.height / 2);
            } 

            // setTransform(horizontal scaling, vertical skewing, horizontal skewing, vertical scaling, horizontal translation, vertical translation)

            async function run() {
                // const plane = new TwoDCoordinatePlane(window.innerWidth, window.innerHeight);
                drawStars(200);
                
                while (true) {
                    currentLocation[0] = (currentLocation[0] - currentVelocity[0]) <= 0 ? canvas.width : (currentLocation[0] - currentVelocity[0]);
                    currentLocation[1] = (currentLocation[1] - currentVelocity[1]) <= 0 ? canvas.height : (currentLocation[1] - currentVelocity[1]);

                    const image = drawShip();
                    
                    context.setTransform(1,0,0,1,0,0);
                    context.clearRect(currentLocation[0],currentLocation[1],image.width, image.height);
                    // context.fillStyle = 'black';
                    context.fillRect(currentLocation[0],currentLocation[1],image.width, image.height);
                    await new Promise(resolve => setTimeout(resolve, (1000/30)));
                }
            }

            run();
        });
        
    </script>
</head>
<body>
<canvas id="content"></canvas>
</body>
</html>